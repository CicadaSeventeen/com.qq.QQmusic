app-id: com.qq.music
runtime: org.freedesktop.Platform
runtime-version: '20.08'
sdk: org.freedesktop.Sdk
command: /app/bin/qqmusic.sh

finish-args:
    - '--share=ipc'
    - '--share=network'
    - '--socket=x11'
    - '--socket=session-bus'
    - '--socket=pulseaudio'
    - '--device=dri'
    - '--device=shm'
    - '--filesystem=/tmp'   # for singleton

build-options:
    strip: false
    no-debuginfo: true

modules:
    -
        name: qqmusic
        only-arches:
            - x86_64
        sources:
            -
                type: script
                commands:
                    - /app/extra/QQmusic/qqmusic --no-sandbox
                dest-filename: qqmusic.sh
            -
                type: script
                commands:
                    - ar x qqmusic_amd64.deb
                    - tar -xf data.tar.xz
                    - mv opt/QQmusic .
                    - rm -rf opt usr control.tar.gz data.tar.xz debian-binary
                dest-filename: apply_extra
            -
                type: extra-data
                filename: qqmusic_amd64.deb
                url: http://dldir1.qq.com/music/clntupate/linux/deb/qqmusic_1.0.6_amd64.deb
                sha256: 42e0663a5439286e64adfc035bcbb82731548bab25f5e628fb085b050a5926c2
                size: 74527272
        buildsystem: simple
        build-commands:
            - mkdir -p /app/bin /app/lib
            - install -m 755 qqmusic.sh /app/bin
            - install -m 755 apply_extra /app/bin
            # Use to extract deb extra file
            - install /usr/lib/x86_64-linux-gnu/libbfd-2.35.1.so /app/lib
            - install /usr/bin/ar /app/bin

